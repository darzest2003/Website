<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ONLINETRADERZ ‚Äî Shop Smarter</title>

<style>
:root {
  --accent: #25D366;
  --accent-dark: #1fa34f;
  --bg: #f6f7fb;
  --text: #0f172a;
  --muted: #6b7280;
  --card-bg: #ffffff;
  --radius: 14px;
  --shadow: 0 8px 24px rgba(15,23,42,0.08);
}

body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  transition: background .3s, color .3s;
}

/* HEADER */
header {
  position: sticky; top: 0; z-index: 99;
  backdrop-filter: blur(10px);
  background: rgba(255,255,255,0.8);
  border-bottom: 1px solid rgba(0,0,0,0.05);
}
.hdr-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 12px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.logo {
  font-weight: 800;
  font-size: 1.4rem;
  color: #05204A;
}
nav a {
  margin: 0 10px;
  text-decoration: none;
  font-weight: 600;
  color: var(--text);
}
nav a:hover {
  color: var(--accent-dark);
}

/* HERO */
.hero {
  display: flex;
  flex-wrap: wrap;
  gap: 30px;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(180deg,#fff,#f9fafb);
  margin: 28px auto;
  padding: 32px;
  border-radius: var(--radius);
  max-width: 1200px;
  box-shadow: var(--shadow);
}
.hero-left { flex: 1 1 340px; }
.hero-left h1 {
  font-size: 2rem;
  color: #05204A;
  margin: 0 0 10px;
}
.hero-left p {
  color: var(--muted);
  margin: 0 0 16px;
}
.hero-left button {
  padding: 12px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 700;
  margin-right: 10px;
}
.btn-primary { background: var(--accent); color: #fff; }
.btn-ghost { background: transparent; border: 1px solid rgba(0,0,0,0.1); }

.hero-right {
  flex: 1 1 300px;
  display: flex;
  justify-content: center;
}
.hero-right img {
  width: 100%;
  max-width: 420px;
  border-radius: var(--radius);
  box-shadow: 0 12px 40px rgba(2,6,23,0.1);
  object-fit: cover;
}

/* PRODUCTS GRID */
.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(260px,1fr));
  gap: 20px;
  max-width: 1200px;
  margin: 0 auto;
}
.card {
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px;
  display: flex;
  flex-direction: column;
  transition: transform .2s ease;
}
.card:hover { transform: translateY(-5px); }
.card img {
  height: 200px;
  object-fit: contain;
  border-radius: 10px;
  background: #f8fafc;
}
.card h3 { margin: 10px 0 5px; }
.card .price { font-weight: 800; color: #05204A; margin-bottom: 8px; }
.card .actions { margin-top: auto; display: flex; gap: 10px; }
.card button {
  flex: 1;
  border: none;
  padding: 10px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
}
.add-btn { background: var(--accent); color: #fff; }
.wa-btn { background: #075e54; color: #fff; }

/* CART DRAWER */
.cart-drawer {
  position: fixed;
  top: 0; right: -420px;
  width: 400px;
  height: 100%;
  background: #fff;
  box-shadow: -4px 0 20px rgba(0,0,0,0.1);
  transition: right 0.3s ease;
  z-index: 999;
  display: flex;
  flex-direction: column;
}
.cart-drawer.open { right: 0; }
.cart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  font-weight: 700;
  border-bottom: 1px solid #e5e7eb;
}
.cart-body {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
}
.cart-item {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 14px;
}
.cart-item img {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border-radius: 8px;
}
.cart-item .meta { flex: 1; }
.cart-footer {
  padding: 16px;
  border-top: 1px solid #e5e7eb;
}
.cart-footer button {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: none;
  font-weight: 700;
  cursor: pointer;
}
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  z-index: 998;
}
.overlay.show { display: block; }

/* ORDER MODAL */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 1000;
}
.modal.open { display: flex; }
.modal-card {
  background: #fff;
  padding: 24px;
  border-radius: var(--radius);
  width: 100%;
  max-width: 500px;
}
.modal-card input, .modal-card textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  margin-bottom: 12px;
}

/* THEMES */
body.dark {
  --bg: #111827;
  --card-bg: #1f2937;
  --text: #f9fafb;
  --muted: #9ca3af;
}
body.blue {
  --accent: #2563eb;
  --accent-dark: #1e40af;
  --bg: #e8f0ff;
}

/* FOOTER */
footer {
  text-align: center;
  margin: 40px 0;
  color: var(--muted);
}
</style>
</head>
<body>

<header>
  <div class="hdr-inner">
    <div class="logo">ONLINETRADERZ</div>
    <nav>
      <a href="#shop">Shop</a>
      <a href="#contact">Contact</a>
    </nav>
    <div>
      <button onclick="toggleTheme('light')">‚òÄÔ∏è</button>
      <button onclick="toggleTheme('dark')">üåô</button>
      <button onclick="toggleTheme('blue')">üíô</button>
      <button onclick="toggleCart()">üõí <span id="cartCount">0</span></button>
    </div>
  </div>
</header>

<section class="hero">
  <div class="hero-left">
    <h1>Welcome to ONLINETRADERZ</h1>
    <p>Quality products at unbeatable prices. Shop confidently with cash on delivery.</p>
    <button class="btn-primary" onclick="scrollToProducts()">Shop Now</button>
  </div>
  <div class="hero-right">
    <img id="heroImg" src="https://via.placeholder.com/600x400?text=Featured+Product" alt="Featured">
  </div>
</section>

<section id="shop" class="products-grid"></section>

<div class="overlay" id="overlay" onclick="toggleCart(false)"></div>
<div class="cart-drawer" id="cartDrawer">
  <div class="cart-header">
    <span>Your Cart</span>
    <button onclick="toggleCart(false)">‚úï</button>
  </div>
  <div class="cart-body" id="cartItems"></div>
  <div class="cart-footer">
    <div style="margin-bottom:10px;">Total: RS.<span id="cartTotal">0</span></div>
    <button class="btn-primary" onclick="checkout()">Checkout</button>
  </div>
</div>

<div class="modal" id="orderModal">
  <div class="modal-card">
    <h3>Submit Your Order</h3>
    <form onsubmit="submitOrder(event)">
      <input id="name" placeholder="Full Name" required>
      <input id="contact" placeholder="Contact Number" required>
      <input id="email" placeholder="Email (optional)" type="email">
      <textarea id="address" placeholder="Full Address" required></textarea>
      <button type="submit" class="btn-primary">Submit</button>
    </form>
  </div>
</div>

<footer id="contact">
  <p>üìß <a href="mailto:farisdaar107@gmail.com">farisdaar107@gmail.com</a> | WhatsApp: <a href="https://wa.me/923444318078" target="_blank">+92 344 4318078</a></p>
  <p>¬© 2025 ONLINETRADERZ ‚Äî Built with care.</p>
</footer>

<script>
const API_BASE = "https://cppbackened.onrender.com";
let products = [];
let cart = [];

/* THEME */
function toggleTheme(t){ document.body.className = t; }

/* SCROLL */
function scrollToProducts(){ document.querySelector('#shop').scrollIntoView({behavior:'smooth'}); }

/* LOAD PRODUCTS */
async function loadProducts(){
  try{
    const res = await fetch(API_BASE+"/api/products");
    const data = await res.json();
    products = Array.isArray(data) ? data : [];
    renderProducts();
    updateHeroImage();
  }catch(e){ console.error(e); updateHeroImage(true); }
}

/* HERO IMAGE LOGIC */
function updateHeroImage(fallback=false){
  const img = document.getElementById('heroImg');
  if(!fallback && products.length && products[0].img){
    let link = products[0].img.startsWith('http') ? products[0].img : API_BASE + (products[0].img.replace(/^public\\//,''));
    img.src = link;
  } else {
    const test = new Image();
    test.onload = ()=>img.src='/public/uploads/featured.jpg';
    test.onerror = ()=>img.src='https://via.placeholder.com/600x400?text=Featured+Product';
    test.src='/public/uploads/featured.jpg';
  }
}

/* RENDER PRODUCTS */
function renderProducts(){
  const grid = document.getElementById('shop');
  grid.innerHTML = '';
  products.forEach(p=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <img src="${p.img ? (p.img.startsWith('http')?p.img:API_BASE+p.img.replace(/^public\\//,'')) : 'https://via.placeholder.com/300'}" alt="${p.title}">
      <h3>${p.title}</h3>
      <div class="price">RS.${p.price}</div>
      <div style="color:var(--muted);font-size:14px;margin-bottom:8px">${p.description||''}</div>
      <div class="actions">
        <button class="add-btn" onclick="addToCart('${p.id}')">Add</button>
        <button class="wa-btn" onclick="window.open('https://wa.me/923444318078?text=I am interested in ${encodeURIComponent(p.title)}')">WA</button>
      </div>`;
    grid.appendChild(card);
  });
}

/* CART */
function toggleCart(show){
  const drawer=document.getElementById('cartDrawer');
  const overlay=document.getElementById('overlay');
  if(show===false){drawer.classList.remove('open');overlay.classList.remove('show');}
  else{drawer.classList.toggle('open');overlay.classList.toggle('show');}
  renderCart();
}
function addToCart(id){
  const p=products.find(x=>x.id===id);
  if(!p)return;
  const ex=cart.find(c=>c.id===id);
  ex?ex.qty++:cart.push({...p,qty:1});
  renderCart();
}
function renderCart(){
  document.getElementById('cartCount').textContent=cart.reduce((s,i)=>s+i.qty,0);
  const list=document.getElementById('cartItems');
  list.innerHTML='';
  let total=0;
  cart.forEach(i=>{
    total+=i.price*i.qty;
    list.innerHTML+=`
      <div class="cart-item">
        <img src="${i.img || 'https://via.placeholder.com/80'}">
        <div class="meta">
          <div>${i.title}</div>
          <div style="font-size:13px;color:var(--muted)">RS.${i.price*i.qty}</div>
        </div>
        <div>
          <button onclick="changeQty('${i.id}',-1)">-</button>
          ${i.qty}
          <button onclick="changeQty('${i.id}',1)">+</button>
        </div>
      </div>`;
  });
  document.getElementById('cartTotal').textContent=total.toFixed(2);
}
function changeQty(id,d){const item=cart.find(c=>c.id===id);if(!item)return;item.qty+=d;if(item.qty<=0)cart=cart.filter(x=>x.id!==id);renderCart();}

/* CHECKOUT */
function checkout(){
  if(cart.length===0)return alert('Cart empty');
  document.getElementById('orderModal').classList.add('open');
}

/* SUBMIT ORDER */
function submitOrder(e){
  e.preventDefault();
  const name=document.getElementById('name').value;
  const contact=document.getElementById('contact').value;
  const email=document.getElementById('email').value;
  const address=document.getElementById('address').value;
  const productsData=cart.map(p=>({product:p.id,qty:p.qty}));
  fetch(API_BASE+'/api/orders',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({products:productsData,name,contact,email,address})
  }).then(r=>r.text()).then(txt=>{
    if(txt.toLowerCase().includes('order placed')){
      alert('Order placed successfully!');
      cart=[];renderCart();
      document.getElementById('orderModal').classList.remove('open');
    }else alert('Failed to submit order.');
  }).catch(()=>alert('Server error.'));
}

/* INIT */
loadProducts();
</script>
</body>
</html>
