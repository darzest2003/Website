
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OnlineTraderz Admin</title>

<link rel="stylesheet" href="admin.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
</head>

<body>

<button id="menuBtn">â˜°</button>

<aside id="sidebar">
  <h2>OnlineTraderz</h2>
  <button class="nav active" data-tab="dashboard">Dashboard</button>
  <button class="nav" data-tab="products">Products</button>
  <button class="nav" data-tab="orders">Orders</button>
  <button class="nav" data-tab="settings">Settings</button>
</aside>

<main>
  <!-- DASHBOARD -->
  <section id="dashboard" class="tab show">
    <div class="cards">
      <div class="card"><h3 id="pCount">0</h3><p>Products</p></div>
      <div class="card"><h3 id="oCount">0</h3><p>Orders</p></div>
      <div class="card"><h3 id="revenue">Rs.0</h3><p>Revenue</p></div>
    </div>
    <canvas id="salesChart"></canvas>
  </section>

  <!-- PRODUCTS -->
  <section id="products" class="tab">
    <h2>Add Product</h2>

    <form id="productForm">
      <input required placeholder="Product Title" id="title">
      <input required type="number" placeholder="Price" id="price">
      <input required type="number" placeholder="Stock" id="stock">

      <input type="file" id="images" multiple accept="image/*" capture="environment">
      <button>Add Product</button>
    </form>

    <div id="productList"></div>
  </section>

  <!-- ORDERS -->
  <section id="orders" class="tab">
    <h2>Orders</h2>
    <div id="orderList"></div>
  </section>

  <!-- SETTINGS -->
  <section id="settings" class="tab">
    <p><b>Shipper:</b> Faris Dar</p>
    <p><b>Contact:</b> 03444318078</p>
    <p><b>Email:</b> farisdaar107@gmail.com</p>
  </section>
</main>

<canvas id="barcode" hidden></canvas>

<script>
/* ------------------ STORAGE ------------------ */
let products = JSON.parse(localStorage.getItem("products")) || [];
let orders = JSON.parse(localStorage.getItem("orders")) || [];

/* ------------------ NAV ------------------ */
document.querySelectorAll(".nav").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".nav").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("show"));
    document.getElementById(btn.dataset.tab).classList.add("show");
    sidebar.classList.remove("open");
  }
});

menuBtn.onclick=()=>sidebar.classList.toggle("open");

/* ------------------ PRODUCTS ------------------ */
productForm.onsubmit=e=>{
  e.preventDefault();

  let imgs=[];
  [...images.files].forEach(f=>{
    let r=new FileReader();
    r.onload=()=>{ imgs.push(r.result); save(); }
    r.readAsDataURL(f);
  });

  function save(){
    if(imgs.length!==images.files.length) return;
    products.push({
      id:Date.now(),
      title:title.value,
      price:+price.value,
      stock:+stock.value,
      imgs
    });
    localStorage.setItem("products",JSON.stringify(products));
    productForm.reset();
    renderProducts();
    updateStats();
  }
};

function renderProducts(){
  productList.innerHTML="";
  products.forEach(p=>{
    productList.innerHTML+=`
      <div class="item">
        <img src="${p.imgs[0]}">
        <div>
          <b>${p.title}</b><br>
          Rs.${p.price} | Stock: ${p.stock}
        </div>
      </div>`;
  });
}

/* ------------------ ORDERS ------------------ */
function renderOrders(){
  orderList.innerHTML="";
  orders.forEach((o,i)=>{
    orderList.innerHTML+=`
    <div class="item">
      <b>#${i+1} ${o.product}</b>
      <p>${o.name} | ${o.contact}</p>
      <button onclick="downloadLabel(${i})">Download Label</button>
    </div>`;
  });
}

/* ------------------ SHIPPING LABEL ------------------ */
function downloadLabel(i){
  const o=orders[i];
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();

  JsBarcode(barcode,o.contact,{displayValue:true});

  pdf.text("SHIPPING LABEL",70,15);
  pdf.rect(10,20,190,120);

  pdf.text(`Product: ${o.product}`,15,30);
  pdf.text(`Name: ${o.name}`,15,40);
  pdf.text(`Contact: ${o.contact}`,15,50);
  pdf.text(`Email: ${o.email}`,15,60);
  pdf.text(`Address: ${o.address}`,15,70);

  pdf.text("Shipper: Faris Dar",15,95);
  pdf.text("Contact: 03444318078",15,105);
  pdf.text("Email: farisdaar107@gmail.com",15,115);

  pdf.addImage(barcode.toDataURL(),"PNG",120,40,60,20);
  pdf.save(`Order_${i+1}.pdf`);
}

/* ------------------ DASHBOARD ------------------ */
function updateStats(){
  pCount.innerText=products.length;
  oCount.innerText=orders.length;
  revenue.innerText="Rs."+orders.reduce((t,o)=>t+(+o.total||0),0);
}

function chart(){
  new Chart(salesChart,{
    type:"line",
    data:{
      labels:orders.map((_,i)=>i+1),
      datasets:[{label:"Sales",data:orders.map(o=>o.total||0)}]
    }
  });
}

/* ------------------ INIT ------------------ */
renderProducts();
renderOrders();
updateStats();
chart();
</script>

</body>
</html>
